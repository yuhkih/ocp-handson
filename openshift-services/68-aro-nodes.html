<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ワーカーノードの追加と削除 :: OpenShift Handson</title>
    <link rel="canonical" href="https://yuhkih.github.io/ocp-handson/openshift-services/68-aro-nodes.html">
    <link rel="prev" href="67-3-aro-alert.html">
    <link rel="next" href="69-aro-upgrade.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://yuhkih.github.io/ocp-handson">OpenShift Handson</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="openshift-services" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">01. OpenShift 基礎</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01_app-mgmt-basics.html">1. コンテナデプロイと管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01_app-deployment.html">2. Web コンソールの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02_app-storage-basics.html">3. 永続ストレージ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03_machinesets.html">4. ノードの動的管理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04_infra-nodes.html">5. Infra ノードの作成</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06_template-quota-limits.html">6. Project のクオータ/制限</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07_clusterresourcequota.html">7. クラスタのクオータ設定</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">20. OpenShift Pipeline Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="10-pipeline-install.html">インストール</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="11-pipelines.html">1. Pipelines -1/2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="12-add-task.html">2. Pipelines -2/2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="13-triggers.html">3. Tekton Triggers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">21. OpenShift GitOps Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20-GitOps-install.html">インストール</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="21-GitOps.html">1. OpenShift GitOps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="22-Kustomize.html">2. Kustomizeインテグレーション</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="23-Helm.html">3. Helmインテグレーション</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">51. Red Hat OpenShift Service on AWS (ROSA) Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="50-rosa-info.html">0. はじめに</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="51-rosa-hcp-create.html">1. ROSA HCPクラスターの作成 [デモ]</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="52-rosa-app-deploy.html">2. サンプルアプリケーションのデプロイ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="53-rosa-ebs.html">3. Amazon EBSの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="54-1-rosa-web-terminal.html">4. Web Terminalの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="54-2-rosa-dev-spaces.html">5. Web IDEを利用した開発</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="58-rosa-bedrock.html">6. Amazon Bedrockアプリケーションの実行</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-1-rosa-log-01.html">7. ロギング設定 [デモ]</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-1-rosa-log-02.html">8. Amazon CloudWatchでのログ確認</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-2-rosa-monitoring.html">9. モニタリング</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-3-rosa-project-metrics.html">10. プロジェクトのメトリクスデータの確認</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="55-4-rosa-alert.html">11. アラート設定</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="56-rosa-nodes.html">12. ワーカーノードの追加と削除</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="57-rosa-upgrade.html">13. ROSA HCPクラスターの更新</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">61. Azure Red Hat OpenShift (ARO) Lab</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="60-aro-info.html">0. はじめに</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="61-aro-create.html">1. AROクラスターの作成 [デモ]</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="62-aro-app-deploy.html">2. サンプルアプリケーションのデプロイ</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="63-aro-storage.html">3. Azure DiskとAzure Filesの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="64-aro-web-terminal.html">4. Web Terminalの利用</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="65-aro-dev-spaces.html">5. Web IDEを利用した開発</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="66-aro-logging.html">6. ロギング</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="67-1-aro-monitoring.html">7. モニタリング</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="67-2-aro-project-metrics.html">8. プロジェクトのメトリクスデータの確認</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="67-3-aro-alert.html">9. アラート設定</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="68-aro-nodes.html">10. ワーカーノードの追加と削除</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="69-aro-upgrade.html">11. AROクラスターの更新[デモ]</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">OpenShift Handson</a></li>
    <li>61. Azure Red Hat OpenShift (ARO) Lab</li>
    <li><a href="68-aro-nodes.html">10. ワーカーノードの追加と削除</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/yuhkih/ocp-handson/edit/master/documentation/modules/ROOT/pages/68-aro-nodes.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">ワーカーノードの追加と削除</h1>
<div class="sect1">
<h2 id="_演習の概要"><a class="anchor" href="#_演習の概要"></a>演習の概要</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このモジュールでは、ワーカーノードの(自動的な)追加と削除を実施します。</p>
</div>
<hr>
<div class="sect2">
<h3 id="_machinesetによるワーカーノードの追加と削除"><a class="anchor" href="#_machinesetによるワーカーノードの追加と削除"></a>MachineSetによるワーカーノードの追加と削除</h3>
<div class="paragraph">
<p>実行するアプリケーションの数が多くなり、ワーカーノードのリソース(CPUやメモリ)使用率が逼迫した場合、
OpenShiftのコンソールからワーカーノードを追加・削除できます。
ARO/OpenShiftのワーカーノードは、MachineSetというリソース単位で管理されており、
ワーカーノードを追加・削除する場合、このMachineSetを作成・編集・削除します。</p>
</div>
<div class="paragraph">
<p>ここでインストラクターから案内された管理アカウントを使って、AROクラスターに再ログインします。
以降の演習は、この管理アカウントを利用します。</p>
</div>
<div class="paragraph">
<p>デフォルトで利用されているMachineSetは、
「管理者向け表示」の「MachineSets」メニューから確認できます。
Japan EastリージョンにあるAROを利用している場合、
デフォルトの構成では3つのアベイラビリティーゾーンに
対応したマシンセットが1つずつ存在します。
これらのマシンセットの中に1台ずつワーカーノードが含まれています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
本演習環境では、ワーカーノードを数台ほど増やしていることがあります。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Azureの仕様により、Japan WestリージョンにあるAROの場合は、
1つのアベイラビリティーゾーンしか利用できないようになっています。
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/machinesets.png" alt="machinesets">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/node-lists.png" alt="node lists">
</div>
</div>
<div class="paragraph">
<p>デフォルトで用意されているマシンセットのうち、いずれかを選択して、
「アクション」→「マシン数の編集」から、マシン台数を編集することで、
ワーカーノードを簡単に追加・削除できるようになっています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/machine-number-edit.png" alt="machine number edit">
</div>
</div>
<div class="paragraph">
<p>しかし、この演習では、デフォルトで用意されているMachineSetは編集せずに、
新しくMachineSetを追加することで、ワーカーノードを追加してみます。</p>
</div>
</div>
<div class="sect2">
<h3 id="_machinesetの作成"><a class="anchor" href="#_machinesetの作成"></a>MachineSetの作成</h3>
<div class="paragraph">
<p>前述した画像にある「MachineSet」のメニューから「MachineSetの作成」をクリックして、
下記のようなMachineSetを定義したYAMLファイルを入力して、MachineSetを作成します。
新規MachineSetの作成に伴い、自動的にワーカーノードが1台( <code>replicas: 1</code> の指定によるもの)
追加されます。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">apiVersion: machine.openshift.io/v1beta1
kind: MachineSet
metadata:
  name: &lt;MachineSet名&gt;
  labels:
    machine.openshift.io/cluster-api-cluster: &lt;AROクラスター名&gt;
    machine.openshift.io/cluster-api-machine-role: worker
    machine.openshift.io/cluster-api-machine-type: worker
  namespace: openshift-machine-api
spec:
  replicas: 1
  selector:
    matchLabels:
      machine.openshift.io/cluster-api-cluster: &lt;AROクラスター名&gt;
      machine.openshift.io/cluster-api-machineset: &lt;MachineSet名&gt;
  template:
    metadata:
      labels:
        machine.openshift.io/cluster-api-cluster: &lt;AROクラスター名&gt;
        machine.openshift.io/cluster-api-machine-role: worker
        machine.openshift.io/cluster-api-machine-type: worker
        machine.openshift.io/cluster-api-machineset: &lt;MachineSet名&gt;
    spec:
      metadata:
        labels:
          &lt;key&gt;: &lt;value&gt;
      providerSpec:
        value:
          location: &lt;リージョン名&gt;
          networkResourceGroup: &lt;ネットワークリソースグループ名&gt;
          publicLoadBalancer: &lt;AROクラスター名&gt;
          resourceGroup: aro-&lt;AROクラスターのインフラID&gt;
          vnet: &lt;Virutal Network名&gt;
          subnet: &lt;サブネット名&gt;
          vmSize: Standard_F4s_v2
          zone: "3"
          image:
            offer: aro4
            publisher: azureopenshift
            resourceID: ""
            sku: &lt;AROのバージョンID&gt;
            version: &lt;AROのバージョン番号が付いたイメージID&gt;
          apiVersion: machine.openshift.io/v1beta1
          credentialsSecret:
            name: azure-cloud-credentials
            namespace: openshift-machine-api
          kind: AzureMachineProviderSpec
          metadata:
            creationTimestamp: null
          userDataSecret:
            name: worker-user-data
          osDisk:
            diskSettings: {}
            diskSizeGB: 128
            managedDisk:
              storageAccountType: Premium_LRS
            osType: Linux
          publicIP: false</code></pre>
</div>
</div>
<div class="paragraph">
<p>MachineSetを新規作成する場合は、既存のMachineSetを参照しながら、値を変更すると便利です。
<code>&lt;&gt;</code> で囲んだところは、AROクラスターの環境に応じて適宜変更します。
具体的な変更内容については、当日インストラクターから案内されますが、
それぞれの変数の説明は次のとおりです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MachineSet名</code> : 任意に指定可能なMachineSet名。(例: testmyaro01-ddm8w-hkojima-worker-eastus3)</p>
</li>
<li>
<p><code>AROクラスター名</code> : マシンセットで参照されるAROクラスターの名前。(例: testmyaro01-ddm8w)</p>
</li>
<li>
<p><code>key, value</code> : マシンセットで指定する任意のラベル名。(例:「key」に「type」、「value」に「hkojima-worker-nodes」を指定。このラベルは後に使いますので、他の受講者と被らないようなラベルを付けて下さい)</p>
</li>
<li>
<p><code>リージョン名</code> : AROクラスターが作成されたリージョン名。(例: japaneast)</p>
</li>
<li>
<p><code>ネットワークリソースグループ名</code> : AROが利用するVirtual Networkリソースがあるリソースグループ名。(例: openenv-hkctf)</p>
</li>
<li>
<p><code>AROクラスターのインフラID</code> : AROクラスターに付けられたID。(例: myopendomain01)</p>
</li>
<li>
<p><code>Virutal Network名</code> : AROクラスターが利用するVirtual Network名。(例: myopenaro-vnet01)</p>
</li>
<li>
<p><code>サブネット名</code> : ワーカーノードが利用するサブネット名。(例: worker-subnet)</p>
</li>
<li>
<p><code>AROのバージョンID</code> : AROのバージョンのID。(例: aro_413)</p>
</li>
<li>
<p><code>AROのバージョン番号が付いたイメージID</code> : イメージID。(例: 413.92.20230614)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これらの変数を設定した、
<a href="https://rh-open.github.io/ocp-handson/openshift-services/_images/aro/nodes/aro-machineset-japaneast3.yaml">MachineSetのサンプルファイル</a>がありますので参考にしてください。
このサンプルでは、 <code>vmSize: Standard_F4s_v2</code> でAROで利用可能な最小サイズのワーカーノードを指定し、
<code>zone: “3”</code> で3番目のアベイラビリティーゾーンを指定しています。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/machineset-create1.png" alt="machineset create1">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/machineset-create2.png" alt="machineset create2">
</div>
</div>
<div class="paragraph">
<p>MachineSetの作成に伴い、対応したワーカーノードに、
前述したMachineSet作成時に指定したラベル(下記画像の例では、一番下のラベル <code>type=hkojima-worker-nodes</code> )が
自動的に付与されます。
このラベルを利用して、Podを特定のラベルが付いたワーカーノードで実行できるようになります。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/node-labels.png" alt="node labels">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_オートスケールの設定"><a class="anchor" href="#_オートスケールの設定"></a>オートスケールの設定</h3>
<div class="paragraph">
<p>ARO/OpenShiftでのオートスケールを設定するには、次の2つの設定が必要になります。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Cluster Autoscaler</code> : クラスター全体のオートスケールの設定。クラスター全体のコントローラおよびワーカーノードの上限値、CPU/メモリの最小/最大値などを設定</p>
</li>
<li>
<p><code>Machine Autoscaler</code> : MachineSetに対するオートスケールの設定。最小台数と最大台数を設定</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cluster Autoscalerは、次のYAMLファイルを利用して、OpenShiftのWebコンソールから設定できます。
これはアラート設定手順の時と同様に、OpenShiftコンソールの右上にある <code>+</code> アイコンから
直接YAMLファイルを入力して作成します。Cluster Autoscalerの名前は、
<code>default</code> を指定する必要がありますので、注意してください。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
本演習をワークショップ形式で実施している場合、Cluster Autoscalerはすでに設定されています。
</td>
</tr>
</table>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">apiVersion: "autoscaling.openshift.io/v1"
kind: "ClusterAutoscaler"
metadata:
  name: "default"
spec:
  podPriorityThreshold: -10
  resourceLimits:
    maxNodesTotal: 60
    cores:
      min: 8
      max: 512
    memory:
      min: 4
      max: 1024
  scaleDown:
    enabled: true
    unneededTime: 6m
    delayAfterAdd: 2m
    delayAfterDelete: 1m
    delayAfterFailure: 15s</code></pre>
</div>
</div>
<div class="paragraph">
<p>この例では、最大60台までノードをデプロイ可能で、オートスケールダウンも設定し、
不要なノードが削除対象になるまでの時間を6分間と指定しています。
その他のパラメータの説明については、
<a href="https://access.redhat.com/documentation/ja-jp/openshift_container_platform/4.14/html-single/machine_management/index#configuring-clusterautoscaler_applying-autoscaling">OpenShiftの製品ドキュメント</a>もご参照ください。</p>
</div>
<div class="paragraph">
<p>Cluster Autoscalerが作成されると、下記の画像の一番下に <code>default</code> という名前で
作成されていることが確認できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/cluster-settings-autoscaler.png" alt="cluster settings autoscaler">
</div>
</div>
<div class="paragraph">
<p>続いて、Machine Autoscalerの設定です。これは前述した手順で
受講者が作成したMachineSetの右側にある「・」が縦に3つ並んだアイコンをクリックして、
「Machine Autoscalerの作成」をクリックし、最小数と最大数を設定するだけの手順です。
今回の演習では、最小数を「1」、最大数を「2」と設定してください。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/machine-autoscaler-settings.png" alt="machine autoscaler settings">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_オートスケールのテスト"><a class="anchor" href="#_オートスケールのテスト"></a>オートスケールのテスト</h3>
<div class="paragraph">
<p>実際にオートスケールをテストしてみます。
受講生が作成したプロジェクトを適宜指定して、
次のYAMLファイルで、busybox Podを15個並列に実行するジョブを実行します。
このジョブも、OpenShiftコンソールの右上にある <code>+</code> アイコンから直接入力して作成します。
このとき、先ほどMachineSetを作成する時に指定したラベルを利用して、
このジョブによって作成されるPodが、受講者が作成したMachineSet内だけで実行されるように、
「nodeSelector」を指定します。</p>
</div>
<div class="paragraph">
<p>ラベルの「key: value」の「value」に相当する文字列(この例では、 <code>&lt;ユーザー名&gt;-worker-nodes</code> )は、
ダブルクォーテーションで囲む必要があります。
これを忘れると、「value」の値が文字列として認識されないため、
ラベルの指定ができず、CPU/メモリのリソースが空いている任意のワーカーノードで
Podが実行されるようになるため、注意してください。</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">apiVersion: batch/v1
kind: Job
metadata:
  generateName: work-queue-
spec:
  template:
    spec:
      nodeSelector:
        type: "&lt;ユーザー名&gt;-worker-nodes"
      containers:
      - name: work
        image: busybox
        command: ["sleep", "360"]
        resources:
          requests:
            memory: 500Mi
            cpu: 500m
      restartPolicy: Never
  backoffLimit: 4
  completions: 15
  parallelism: 15</code></pre>
</div>
</div>
<div class="paragraph">
<p>ジョブを実行して数分待つと、MachineSet Autoscalerを設定したMachineSetによって、
自動的にワーカーノードが1台追加され、追加されたワーカーノード上でPodが実行されることを確認できます。
これらは「Jobs」メニューや、「コンピュート」の中にある「Node」や「MachineSet」といったメニューを見ることで確認できます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/job-status.png" alt="job status">
</div>
</div>
<div class="paragraph">
<p>この演習環境の場合、ジョブ実行が完了し、不要になったワーカーノード1台が
オートスケールダウンによって削除されるまで、20分ほどかかります。
途中でジョブの実行を中止したい場合、当該ジョブを選択して、
右上の「アクション」メニューから、「Jobの削除」を選択して「削除」を選択します。
これによりジョブによって起動されたPodが全て削除され、数分経つと、自動的にワーカーノードが1台削除されます。</p>
</div>
<div class="paragraph">
<p>最後に受講生が作成したMachineSetを削除します。
当該MachineSetを選択して、「MachineSetの削除」を選択することで、
MachineSet及びそれに紐づく全てのワーカーノードが削除されます。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/aro/nodes/machineset-delete.png" alt="machineset delete">
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="67-3-aro-alert.html">9. アラート設定</a></span>
  <span class="next"><a href="69-aro-upgrade.html">11. AROクラスターの更新[デモ]</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
